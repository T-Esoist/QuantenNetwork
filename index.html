<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-ESOIST | Absolute Extraction</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { background: #000; color: #00f2ff; font-family: 'Courier New', monospace; padding: 15px; text-align: center; }
        .grid-box { border: 2px solid #00f2ff; padding: 20px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,242,255,0.2); }
        .led { height: 15px; width: 15px; border-radius: 50%; display: inline-block; background: #ff0055; box-shadow: 0 0 10px #ff0055; }
        .active { background: #00ff00; box-shadow: 0 0 15px #00ff00; }
        .btn { width: 100%; background: #00f2ff; color: #000; border: none; padding: 18px; font-weight: bold; cursor: pointer; border-radius: 10px; margin-top: 15px; }
        input { width: 100%; background: #111; border: 1px solid #00f2ff; color: #fff; padding: 15px; margin: 10px 0; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="grid-box">
        <h2>ABSOLUTE EXTRACTION v87</h2>
        <div><span id="led" class="led"></span> <span id="status">INITIATING...</span></div>
        
        <button class="btn" onclick="document.getElementById('up').click()">GALERIE-DATA ERNTEN</button>
        <input type="file" id="up" style="display:none" accept="image/*" onchange="extract(event)">
        
        <div id="result-layer" style="margin-top:20px;">
            <input type="text" id="target" placeholder="EMPFÄNGER (EXTRAHIERT)">
            <input type="text" id="val" placeholder="BETRAG (€) (EXTRAHIERT)">
            <button class="btn" style="background:#ff0055; color:#fff;" onclick="sign()">ESI-DEBIT SIGNIEREN</button>
        </div>
    </div>

    <script>
        const q = new Html5Qrcode("hidden-reader");
        function extract(event) {
            const f = event.target.files[0];
            const s = document.getElementById('status');
            const l = document.getElementById('led');
            
            s.innerText = "ERNDTE DATEN...";
            l.classList.add('active');

            Html5Qrcode.scanImage(f, { fps: 30 })
                .then(data => {
                    s.innerText = "KOHÄRENZ HERGESTELLT";
                    // Absolute Suche nach Beträgen: Findet alles wie 10.00 oder 15,50
                    const m = data.match(/[0-9]+[.,][0-9]{2}/);
                    document.getElementById('val').value = m ? m[0].replace(',', '.') : "MANUELL PRÜFEN";
                    document.getElementById('target').value = "GLÄUBIGER IDENTIFIZIERT";
                })
                .catch(e => {
                    s.innerText = "BARRIERE: MANUELLE EINGABE AKTIVIERT";
                    l.classList.remove('active');
                });
        }
        function sign() { alert("Gitter-Transaktion autorisiert."); location.reload(); }
    </script>
    <div id="hidden-reader" style="display:none"></div>
</body>
</html>