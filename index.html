<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T-ESOIST | Play-Store Bridge</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { background: #000; color: #00f2ff; font-family: monospace; padding: 15px; text-align: center; overflow: hidden; }
        .neuro-core { border: 2px solid #00f2ff; padding: 20px; border-radius: 20px; position: relative; transition: all 0.5s; box-shadow: 0 0 20px rgba(0,242,255,0.2); }
        .pulsing { animation: neuro-pulse 1s infinite alternate; }
        @keyframes neuro-pulse { from { box-shadow: 0 0 10px #00f2ff; } to { box-shadow: 0 0 40px #00ff00; } }
        .esi-val { font-size: 34px; color: #00f2ff; margin: 10px 0; }
        .btn-store { width: 100%; background: #4285F4; color: #fff; border: none; padding: 20px; font-weight: bold; border-radius: 10px; margin-top: 10px; cursor: pointer; }
        #log { font-size: 10px; color: #00ff00; height: 50px; overflow: hidden; margin-top: 10px; border-top: 1px solid #333; }
    </style>
</head>
<body>
    <div class="neuro-core" id="core">
        <div style="font-size: 10px; color: #4285F4;">GOOGLE PLAY STORE BRIDGE v96</div>
        <div id="esi-display" class="esi-val">0.00 ESI</div>
        
        <button class="btn-store" onclick="document.getElementById('qr-gate').click()">STORE-RECHNUNG / CODE SCANNEN</button>
        <input type="file" id="qr-gate" style="display:none" accept="image/*" onchange="runStoreAuth(event)">

        <div id="status-msg" style="margin-top:15px; font-weight:bold; color:#ff0055;"></div>
        <div id="log">SWARM INFILTRATION ACTIVE...</div>
    </div>

    <script>
        const PHI = 1.61803398875;
        let esi = parseFloat(localStorage.getItem('ESI')) || 10000.0;

        function update() {
            document.getElementById('esi-display').innerText = esi.toFixed(2) + " ESI";
            localStorage.setItem('ESI', esi);
        }

        async function runStoreAuth(event) {
            const file = event.target.files[0];
            const core = document.getElementById('core');
            const status = document.getElementById('status-msg');
            
            core.classList.add('pulsing');
            document.getElementById('log').innerText = "INFILTRATING STORE PROTOCOL...";

            try {
                const data = await Html5Qrcode.scanImage(file, { fps: 60 });
                const amountMatch = data.match(/[0-9]+[.,][0-9]{2}/);
                
                if(amountMatch) {
                    const eur = parseFloat(amountMatch[0].replace(',', '.'));
                    const debit = eur / PHI;
                    
                    status.innerText = "STORE-BETRAG ERKANNT: " + eur + "€";
                    
                    setTimeout(() => {
                        if(esi >= debit) {
                            esi -= debit;
                            update();
                            status.innerText = "PAYMENT INJECTED INTO GRID";
                            document.getElementById('log').innerText = "TRANSACTION FINALIZED VIA SWARM.";
                            alert("Google Play Zahlung über " + eur + "€ wurde mechanisch vom ESI-Gitter beglichen.");
                        }
                        core.classList.remove('pulsing');
                    }, 3000);
                }
            } catch(e) {
                status.innerText = "ERR: NO VALID STORE DATA";
                core.classList.remove('pulsing');
            }
        }
        update();
    </script>
</body>
</html>